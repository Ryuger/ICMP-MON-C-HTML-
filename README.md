# ICMP-MON-C-HTML-

ICMP мониторинг на C (Windows, MSVC) с веб-интерфейсом.

## Что исправлено
- Группы визуально разделены по вкладкам; внутри вкладки — подгруппы секциями.
- На главной странице только обзор и навигация; редактирование параметров выполняется только в карточке конкретного хоста.
- Excel-совместимый импорт/экспорт через CSV (`/api/export.csv`, `/api/import.csv`).
- Импорт из `hosts.txt` при старте отключен: хосты поднимаются из БД, а добавление/импорт выполняется через web UI (CSV).
- Исправлен парсинг `\r\n`/пробелов в hosts файле.
- Очередь пингов переведена на FIFO (без LIFO-голодания), добавлен флаг `queued` на хост чтобы не копить дубликаты задач.
- Начальный опрос хостов стартует сразу (без растягивания первой волны), чтобы UNKNOWN быстрее переходил в UP/DOWN.
- Автоподбор числа worker-потоков под цель первичного прохода (~3 секунды) с верхним лимитом 1024.

## Детальная страница хоста
- Любые изменения хоста сохраняются в SQLite и восстанавливаются после перезапуска сервера.
- Клик по хосту открывает `/host?id=...` (drill-down).
- Слева: группа/подгруппа, IP, текущий статус, OK/Fail (потери), last/avg/min/max, количество сэмплов + форма редактирования (interval_ms, timeout_ms, down_threshold, enabled).
- Справа: график в реальном времени по всей истории из БД; точки/потери с подсказкой по наведению (время, статус, RTT/loss).
- График хоста теперь интерактивный: Live-режим (автоскролл влево/новые точки справа), выбор окна (1m/5m/15m/1h/6h/All), pan (◀ ▶ и drag мышью), zoom (кнопки и колесо), reset и tooltip по точкам/потерям.
- Масштаб по Y фиксируется от полного набора данных (чтобы при zoom/pan не «плавали» значения RTT визуально).
- Если разрыв между замерами больше `2 * interval_ms`, участок считается отсутствием мониторинга и рисуется жёлтым на уровне 0ms. Потери пакетов рисуются красным на уровне 0ms.

## CSV для Excel
Колонки:
`group,subgroup,host,interval_ms,timeout_ms,down_threshold,enabled`

Поддерживаются CSV с разделителем `,` и `;` (включая файлы Excel с локальным `;`).

Кнопка «Подробнее» показывает предварительное сравнение: сколько строк можно импортировать, какие уже есть в системе и какие дублируются внутри файла.

Единицы измерения:
- `interval_ms` и `timeout_ms` — миллисекунды (ms)
- `down_threshold` — количество подряд неудачных попыток (fails)

## Сборка (MSVC)
```bat
cl /O2 /MT /TC icmpmon.c sqlite3.c /link ws2_32.lib iphlpapi.lib
```

## Запуск
```bat
icmpmon.exe 1000 64 1000 3 512 8080 1 icmpmon.db
```
Веб интерфейс: `http://127.0.0.1:8080/`
